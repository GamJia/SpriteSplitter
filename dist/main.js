"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.unload = exports.load = exports.methods = void 0;
const editor_exports_1 = require("./utils/editor-exports");
const fs = require('fs');
const path = require('path');
const PNG = require('pngjs').PNG;
exports.methods = {
    OpenPanel() {
        editor_exports_1.Editor.Panel.open('spritesplitter.index');
    },
    async SplitByGrid(params) {
        const { pngPath, cols, rows } = params;
        try {
            const data = fs.readFileSync(pngPath);
            const pngImage = PNG.sync.read(data);
            const { width, height } = pngImage;
            const tileWidth = Math.floor(width / cols);
            const tileHeight = Math.floor(height / rows);
            const imageName = path.basename(pngPath, path.extname(pngPath));
            const outputFolderPath = path.join(path.dirname(pngPath), imageName); // 폴더 이름을 이미지 이름과 동일하게
            console.log(`Output folder: ${outputFolderPath}`);
            if (!fs.existsSync(outputFolderPath)) {
                fs.mkdirSync(outputFolderPath, { recursive: true });
            }
            for (let y = 0; y < rows; y++) {
                for (let x = 0; x < cols; x++) {
                    const startX = x * tileWidth;
                    const startY = y * tileHeight;
                    const tile = new PNG({ width: tileWidth, height: tileHeight });
                    for (let py = 0; py < tileHeight; py++) {
                        for (let px = 0; px < tileWidth; px++) {
                            const originalIndex = ((startY + py) * width + (startX + px)) * 4;
                            const tileIndex = (py * tileWidth + px) * 4;
                            for (let i = 0; i < 4; i++) {
                                tile.data[tileIndex + i] = pngImage.data[originalIndex + i];
                            }
                        }
                    }
                    const tileIndex = y * cols + x;
                    const outputFilePath = path.join(outputFolderPath, `tile_${tileIndex}.png`);
                    fs.writeFileSync(outputFilePath, PNG.sync.write(tile));
                }
            }
            return { success: true, message: 'Image split successfully', outputFolderPath };
        }
        catch (error) {
            if (error instanceof Error) {
                console.error('Error during PNG split:', error.message);
                return { success: false, message: error.message };
            }
            return { success: false, message: 'An unknown error occurred' };
        }
    },
    async SplitByPixelSize(params) {
        const { pngPath, x, y } = params;
        try {
            const data = fs.readFileSync(pngPath);
            const pngImage = PNG.sync.read(data);
            const { width, height } = pngImage;
            const cols = Math.floor(width / x);
            const rows = Math.floor(height / y);
            const imageName = path.basename(pngPath, path.extname(pngPath));
            const outputFolderPath = path.join(path.dirname(pngPath), imageName);
            console.log(`Output folder: ${outputFolderPath}`);
            if (!fs.existsSync(outputFolderPath)) {
                fs.mkdirSync(outputFolderPath, { recursive: true });
            }
            for (let row = 0; row < rows; row++) {
                for (let col = 0; col < cols; col++) {
                    const startX = col * x;
                    const startY = row * y;
                    const tile = new PNG({ width: x, height: y });
                    for (let py = 0; py < y; py++) {
                        for (let px = 0; px < x; px++) {
                            const originalIndex = ((startY + py) * width + (startX + px)) * 4;
                            const tileIndex = (py * x + px) * 4;
                            for (let i = 0; i < 4; i++) {
                                tile.data[tileIndex + i] = pngImage.data[originalIndex + i];
                            }
                        }
                    }
                    const tileIndex = row * cols + col;
                    const outputFilePath = path.join(outputFolderPath, `tile_${tileIndex}.png`);
                    fs.writeFileSync(outputFilePath, PNG.sync.write(tile));
                }
            }
            return { success: true, message: 'Image split successfully by pixel size', outputFolderPath };
        }
        catch (error) {
            if (error instanceof Error) {
                console.error('Error during PNG split by pixel size:', error.message);
                return { success: false, message: error.message };
            }
            return { success: false, message: 'An unknown error occurred' };
        }
    }
};
function load() {
    // Extension load hook (if needed)
}
exports.load = load;
function unload() {
    // Extension unload hook (if needed)
}
exports.unload = unload;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NvdXJjZS9tYWluLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLDJEQUFnRDtBQUNoRCxNQUFNLEVBQUUsR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDekIsTUFBTSxJQUFJLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0FBQzdCLE1BQU0sR0FBRyxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQyxHQUFHLENBQUM7QUFFcEIsUUFBQSxPQUFPLEdBQTRDO0lBRTVELFNBQVM7UUFDTCx1QkFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsc0JBQXNCLENBQUMsQ0FBQztJQUM5QyxDQUFDO0lBRUQsS0FBSyxDQUFDLFdBQVcsQ0FBQyxNQUF1RDtRQUNyRSxNQUFNLEVBQUUsT0FBTyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsR0FBRyxNQUFNLENBQUM7UUFFdkMsSUFBSTtZQUNBLE1BQU0sSUFBSSxHQUFHLEVBQUUsQ0FBQyxZQUFZLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDdEMsTUFBTSxRQUFRLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDckMsTUFBTSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsR0FBRyxRQUFRLENBQUM7WUFFbkMsTUFBTSxTQUFTLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLENBQUM7WUFDM0MsTUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLENBQUM7WUFDN0MsTUFBTSxTQUFTLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO1lBQ2hFLE1BQU0sZ0JBQWdCLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FB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S0FBYyxFQUFFO1lBQ3JCLElBQUksS0FBSyxZQUFZLEtBQUssRUFBRTtnQkFDeEIsT0FBTyxDQUFDLEtBQUssQ0FBQyx1Q0FBdUMsRUFBRSxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUM7Z0JBQ3RFLE9BQU8sRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFLE9BQU8sRUFBRSxLQUFLLENBQUMsT0FBTyxFQUFFLENBQUM7YUFDckQ7WUFDRCxPQUFPLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxPQUFPLEVBQUUsMkJBQTJCLEVBQUUsQ0FBQztTQUNuRTtJQUNMLENBQUM7Q0FDSixDQUFDO0FBRUYsU0FBZ0IsSUFBSTtJQUNoQixrQ0FBa0M7QUFDdEMsQ0FBQztBQUZELG9CQUVDO0FBRUQsU0FBZ0IsTUFBTTtJQUNsQixvQ0FBb0M7QUFDeEMsQ0FBQztBQUZELHdCQUVDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRWRpdG9yIH0gZnJvbSBcIi4vdXRpbHMvZWRpdG9yLWV4cG9ydHNcIjtcclxuY29uc3QgZnMgPSByZXF1aXJlKCdmcycpO1xyXG5jb25zdCBwYXRoID0gcmVxdWlyZSgncGF0aCcpO1xyXG5jb25zdCBQTkcgPSByZXF1aXJlKCdwbmdqcycpLlBORztcclxuXHJcbmV4cG9ydCBjb25zdCBtZXRob2RzOiB7IFtrZXk6IHN0cmluZ106ICguLi5hbnk6IGFueSkgPT4gYW55IH0gPSB7XHJcblxyXG4gICAgT3BlblBhbmVsKCkge1xyXG4gICAgICAgIEVkaXRvci5QYW5lbC5vcGVuKCdzcHJpdGVzcGxpdHRlci5pbmRleCcpO1xyXG4gICAgfSxcclxuXHJcbiAgICBhc3luYyBTcGxpdEJ5R3JpZChwYXJhbXM6IHsgcG5nUGF0aDogc3RyaW5nLCBjb2xzOiBudW1iZXIsIHJvd3M6IG51bWJlciB9KTogUHJvbWlzZTxhbnk+IHtcclxuICAgICAgICBjb25zdCB7IHBuZ1BhdGgsIGNvbHMsIHJvd3MgfSA9IHBhcmFtcztcclxuXHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgY29uc3QgZGF0YSA9IGZzLnJlYWRGaWxlU3luYyhwbmdQYXRoKTtcclxuICAgICAgICAgICAgY29uc3QgcG5nSW1hZ2UgPSBQTkcuc3luYy5yZWFkKGRhdGEpO1xyXG4gICAgICAgICAgICBjb25zdCB7IHdpZHRoLCBoZWlnaHQgfSA9IHBuZ0ltYWdlO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgdGlsZVdpZHRoID0gTWF0aC5mbG9vcih3aWR0aCAvIGNvbHMpO1xyXG4gICAgICAgICAgICBjb25zdCB0aWxlSGVpZ2h0ID0gTWF0aC5mbG9vcihoZWlnaHQgLyByb3dzKTtcclxuICAgICAgICAgICAgY29uc3QgaW1hZ2VOYW1lID0gcGF0aC5iYXNlbmFtZShwbmdQYXRoLCBwYXRoLmV4dG5hbWUocG5nUGF0aCkpO1xyXG4gICAgICAgICAgICBjb25zdCBvdXRwdXRGb2xkZXJQYXRoID0gcGF0aC5qb2luKHBhdGguZGlybmFtZShwbmdQYXRoKSwgaW1hZ2VOYW1lKTsgLy8g7Y+0642UIOydtOumhOydhCDsnbTrr7jsp4Ag7J2066aE6rO8IOuPmeydvO2VmOqyjFxyXG5cclxuICAgICAgICAgICAgY29uc29sZS5sb2coYE91dHB1dCBmb2xkZXI6ICR7b3V0cHV0Rm9sZGVyUGF0aH1gKTtcclxuXHJcbiAgICAgICAgICAgIGlmICghZnMuZXhpc3RzU3luYyhvdXRwdXRGb2xkZXJQYXRoKSkge1xyXG4gICAgICAgICAgICAgICAgZnMubWtkaXJTeW5jKG91dHB1dEZvbGRlclBhdGgsIHsgcmVjdXJzaXZlOiB0cnVlIH0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmb3IgKGxldCB5ID0gMDsgeSA8IHJvd3M7IHkrKykge1xyXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCBjb2xzOyB4KyspIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBzdGFydFggPSB4ICogdGlsZVdpZHRoO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0YXJ0WSA9IHkgKiB0aWxlSGVpZ2h0O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBjb25zdCB0aWxlID0gbmV3IFBORyh7IHdpZHRoOiB0aWxlV2lkdGgsIGhlaWdodDogdGlsZUhlaWdodCB9KTtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBweSA9IDA7IHB5IDwgdGlsZUhlaWdodDsgcHkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBweCA9IDA7IHB4IDwgdGlsZVdpZHRoOyBweCsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBvcmlnaW5hbEluZGV4ID0gKChzdGFydFkgKyBweSkgKiB3aWR0aCArIChzdGFydFggKyBweCkpICogNDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRpbGVJbmRleCA9IChweSAqIHRpbGVXaWR0aCArIHB4KSAqIDQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDQ7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbGUuZGF0YVt0aWxlSW5kZXggKyBpXSA9IHBuZ0ltYWdlLmRhdGFbb3JpZ2luYWxJbmRleCArIGldO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBjb25zdCB0aWxlSW5kZXggPSB5ICogY29scyArIHg7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgb3V0cHV0RmlsZVBhdGggPSBwYXRoLmpvaW4ob3V0cHV0Rm9sZGVyUGF0aCwgYHRpbGVfJHt0aWxlSW5kZXh9LnBuZ2ApO1xyXG4gICAgICAgICAgICAgICAgICAgIGZzLndyaXRlRmlsZVN5bmMob3V0cHV0RmlsZVBhdGgsIFBORy5zeW5jLndyaXRlKHRpbGUpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgbWVzc2FnZTogJ0ltYWdlIHNwbGl0IHN1Y2Nlc3NmdWxseScsIG91dHB1dEZvbGRlclBhdGggfTtcclxuICAgICAgICB9IGNhdGNoIChlcnJvcjogdW5rbm93bikge1xyXG4gICAgICAgICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBFcnJvcikge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZHVyaW5nIFBORyBzcGxpdDonLCBlcnJvci5tZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBlcnJvci5tZXNzYWdlIH07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6ICdBbiB1bmtub3duIGVycm9yIG9jY3VycmVkJyB9O1xyXG4gICAgICAgIH1cclxuICAgIH0sXHJcblxyXG4gICAgYXN5bmMgU3BsaXRCeVBpeGVsU2l6ZShwYXJhbXM6IHsgcG5nUGF0aDogc3RyaW5nLCB4OiBudW1iZXIsIHk6IG51bWJlciB9KTogUHJvbWlzZTxhbnk+IHtcclxuICAgICAgICBjb25zdCB7IHBuZ1BhdGgsIHgsIHkgfSA9IHBhcmFtcztcclxuXHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgY29uc3QgZGF0YSA9IGZzLnJlYWRGaWxlU3luYyhwbmdQYXRoKTtcclxuICAgICAgICAgICAgY29uc3QgcG5nSW1hZ2UgPSBQTkcuc3luYy5yZWFkKGRhdGEpO1xyXG4gICAgICAgICAgICBjb25zdCB7IHdpZHRoLCBoZWlnaHQgfSA9IHBuZ0ltYWdlO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgY29scyA9IE1hdGguZmxvb3Iod2lkdGggLyB4KTtcclxuICAgICAgICAgICAgY29uc3Qgcm93cyA9IE1hdGguZmxvb3IoaGVpZ2h0IC8geSk7XHJcbiAgICAgICAgICAgIGNvbnN0IGltYWdlTmFtZSA9IHBhdGguYmFzZW5hbWUocG5nUGF0aCwgcGF0aC5leHRuYW1lKHBuZ1BhdGgpKTtcclxuICAgICAgICAgICAgY29uc3Qgb3V0cHV0Rm9sZGVyUGF0aCA9IHBhdGguam9pbihwYXRoLmRpcm5hbWUocG5nUGF0aCksIGltYWdlTmFtZSk7XHJcblxyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgT3V0cHV0IGZvbGRlcjogJHtvdXRwdXRGb2xkZXJQYXRofWApO1xyXG5cclxuICAgICAgICAgICAgaWYgKCFmcy5leGlzdHNTeW5jKG91dHB1dEZvbGRlclBhdGgpKSB7XHJcbiAgICAgICAgICAgICAgICBmcy5ta2RpclN5bmMob3V0cHV0Rm9sZGVyUGF0aCwgeyByZWN1cnNpdmU6IHRydWUgfSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZvciAobGV0IHJvdyA9IDA7IHJvdyA8IHJvd3M7IHJvdysrKSB7XHJcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBjb2wgPSAwOyBjb2wgPCBjb2xzOyBjb2wrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0YXJ0WCA9IGNvbCAqIHg7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RhcnRZID0gcm93ICogeTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdGlsZSA9IG5ldyBQTkcoeyB3aWR0aDogeCwgaGVpZ2h0OiB5IH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAobGV0IHB5ID0gMDsgcHkgPCB5OyBweSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IHB4ID0gMDsgcHggPCB4OyBweCsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBvcmlnaW5hbEluZGV4ID0gKChzdGFydFkgKyBweSkgKiB3aWR0aCArIChzdGFydFggKyBweCkpICogNDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRpbGVJbmRleCA9IChweSAqIHggKyBweCkgKiA0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA0OyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aWxlLmRhdGFbdGlsZUluZGV4ICsgaV0gPSBwbmdJbWFnZS5kYXRhW29yaWdpbmFsSW5kZXggKyBpXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdGlsZUluZGV4ID0gcm93ICogY29scyArIGNvbDtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBvdXRwdXRGaWxlUGF0aCA9IHBhdGguam9pbihvdXRwdXRGb2xkZXJQYXRoLCBgdGlsZV8ke3RpbGVJbmRleH0ucG5nYCk7XHJcbiAgICAgICAgICAgICAgICAgICAgZnMud3JpdGVGaWxlU3luYyhvdXRwdXRGaWxlUGF0aCwgUE5HLnN5bmMud3JpdGUodGlsZSkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBtZXNzYWdlOiAnSW1hZ2Ugc3BsaXQgc3VjY2Vzc2Z1bGx5IGJ5IHBpeGVsIHNpemUnLCBvdXRwdXRGb2xkZXJQYXRoIH07XHJcbiAgICAgICAgfSBjYXRjaCAoZXJyb3I6IHVua25vd24pIHtcclxuICAgICAgICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2YgRXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGR1cmluZyBQTkcgc3BsaXQgYnkgcGl4ZWwgc2l6ZTonLCBlcnJvci5tZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBlcnJvci5tZXNzYWdlIH07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6ICdBbiB1bmtub3duIGVycm9yIG9jY3VycmVkJyB9O1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufTtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBsb2FkKCkge1xyXG4gICAgLy8gRXh0ZW5zaW9uIGxvYWQgaG9vayAoaWYgbmVlZGVkKVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gdW5sb2FkKCkge1xyXG4gICAgLy8gRXh0ZW5zaW9uIHVubG9hZCBob29rIChpZiBuZWVkZWQpXHJcbn1cclxuIl19